@model IEnumerable<Group20_IoT.Models.Users>

@{
    ViewBag.Title = "Index";
}

<h2>Index</h2>

<p>
    @Html.ActionLink("Create New", "Create")
</p>
<table class="table">
    <tr>
        <th>
            @Html.DisplayNameFor(model => model.Role.Type)
        </th>
        <th>
            Name
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Email)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Access)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Notify)
        </th>
        <th>

        </th>
    </tr>

    @foreach (var item in Model)
    {
        <tr>
            <td>
                @Html.DisplayFor(modelItem => item.Role.Type)
            </td>
            <td>
                @item.GetFullName()
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Email)
            </td>
            @if (item.Access)
            {
                <td>
                    Yes
                </td>
            }
            else
            {
                <td>
                    No
                </td>
            }
            @if (item.Notify)
            {
                <td>
                    Yes
                </td>
            }
            else
            {
                <td>
                    No
                </td>
            }
        <td>
            @Html.ActionLink("Manage User", "ManageUser", new { id = item.Id })
        </td>

        </tr>
    }

</table>

@section scripts
{
    <script>
        $(document).ready(function () {

            var storedMessage = localStorage.getItem('notificationMessage');

            if (storedMessage) {
                notifySuccess(storedMessage);
                localStorage.removeItem('notificationMessage');
            }

        $(".restrict-button").on("click", function () {
            var userId = $(this).data("user-id");
            updateUserStatusRestrict(userId, false);
        });

        $(".unrestrict-button").on("click", function () {
            var userId = $(this).data("user-id");
            updateUserStatusUnrestrict(userId, true);
        });

        function updateUserStatusRestrict(userId) {
            $.ajax({
                url: '@Url.Action("Restrict", "Users")',
                type: 'POST',
                data: { id: userId },
                dataType: 'json',
                success: function (data) {
                    localStorage.setItem('notificationMessage', data.message);
                    location.reload();
                },
                error: function () {
                    notifyError("An error occurred while updating user status.");

                }
            });
        }

        function updateUserStatusUnrestrict(userId, isActive) {
            $.ajax({
                url: '@Url.Action("Unrestrict", "Users")',
                type: 'POST',
                data: { id: userId },
                dataType: 'json',
                success: function (data) {
                    localStorage.setItem('notificationMessage', data.message);
                    location.reload();
                },
                error: function () {
                    alert("An error occurred while updating user status.");
                }
            });
        }
    });
    </script>


}